通过结合 PhysioNet Challenge 2016 和 CirCor Heart Sound 两个公开数据集，我们计划构建一个面向心音杂音三分类（存在 / 不存在 / 不确定）的统一评估基准，并以 7:2:1 的比例在病人级别上划分训练、验证和测试集。2025 年的研究趋势显示，心音分析正从单一的 CNN/RNN 向「自监督音频基础模型 + 状态空间建模 + 多模态元数据融合」的方向演进，同时强调临床可靠性和不确定性评估。针对这些趋势，我们提出 Heart-MambaFormer 框架，主要包含四个核心模块：

1. 心音信号的全栈预处理：对原始 PCG 信号进行 20–800 Hz 带通滤波、基于小波包的去噪、心动周期分割（使用 2024 年开源的 PCG-SSF 心音状态空间分割器），再将每个周期对齐堆叠，通过心动周期自适应重采样（CPAR）保证输入的长度一致。并行提取多尺度特征，包括 log-Mel 谱（32/64/128 个 Mel 滤波器）、连续小波变换谱和心动周期节律特征。

2. 预训练音频骨干与状态空间建模融合：以 2024 年发布的 BEATs v2 Large 和 2025 年最新的 Audio-Mamba (AM-1B) 自监督模型作为冻结或部分微调的主干，分别处理频谱和原始波形，输出帧级表示。引入多尺度状态空间块（MS-SSM）对帧级特征进行长程建模，结合门控线性单元 (GLU) 与选择性扫描机制，以低成本捕捉杂音在多个周期内的演变。

3. 空间—语义跨模态注意力融合：将四个听诊位置的片段视为多实例输入，引入跨位置注意力池化（Location-aware Cross Attention Pooling, LCAP），并将患者元数据（年龄、身高、体重、性别、孕期、听诊位置等）通过语义嵌入后与音频特征融合。使用置信度引导的对比学习损失（Confidence-Aware Supervised Contrastive Loss, CaSCL），同时对存在 / 不存在 / 不确定类别建模，并估计样本级不确定性。

4. 训练策略与推理：采用混合精度和 Fully Sharded Data Parallel (FSDP) 训练，利用 8 卡 GPU 执行梯度累积。训练阶段使用分阶段微调策略——先冻结预训练骨干，仅训练状态空间和融合层；随后逐步解冻骨干前几层；最后进行小学习率的全局微调。数据增强包含随机带通、时频旋转、SpecAugment、心动周期随机遮挡、噪声混合（PhysioNet 2016 的现实噪声片段）等。推理时使用五折 TTA（不同增益和随机遮挡），并通过温度标定获得置信区间。

评估与目标：
- 指标：主指标为宏平均 F1 (macro-F1) 和加权准确率 (weighted accuracy)，同时报告 AUROC、AUPRC 以及不确定性校准指标（ECE/MCE）。
- 数据划分：按病人级别分层抽样，保持 3 个类别的比例一致。PhysioNet 2016 与 CirCor 数据集各自划分 7:2:1，再在训练阶段按权重混合（基于样本量与噪声等级的 dynamic reweighting）。
- 优化目标：在自构建的测试集上，宏平均 F1 目标 > 0.93，超过公开文献中针对 CirCor 数据集的最新记录（2024 年文献报道的 macro-F1 ≈ 0.89），从而实现新的 SOTA。

迭代策略：
- 若基线微调结果未达到目标，将依次引入（a）类内困难样本挖掘与重加权；（b）自蒸馏与标签平滑；（c）多任务学习（同时预测 Outcome/病变部位）；（d）对不确定类使用半监督伪标签优化。
- 实验全程记录配置（config yaml）、日志（TensorBoard/Weights & Biases）与代码版本，确保可复现性。

最终，该方法期望通过预训练音频模型、状态空间建模、多位置融合和元数据整合，实现对心音杂音存在性的精确分类，并为临床部署提供可靠的置信度评估。
